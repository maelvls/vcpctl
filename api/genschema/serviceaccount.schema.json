{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://example.com/wim-manifest.schema.json",
  "title": "CyberArk Workload Identity Manager Manifests",
  "description": "Schema describing the YAML manifests consumed by vcpctl.",
  "$comments": "Inspired by https://api.venafi.cloud/v3/api-docs/account-service and https://api.venafi.cloud/v3/api-docs/vcamanagement-service",
  "allOf": [
    {
      "type": "object",
      "properties": {
        "apiVersion": {
          "type": "string"
        },
        "kind": {
          "const": "ServiceAccount"
        }
      },
      "required": [
        "kind",
        "name"
      ]
    },
    {
      "$ref": "#/$defs/ServiceAccountBaseObject"
    }
  ],
  "$defs": {
    "Scope": {
      "description": "The service account authorization scopes",
      "example": "distributed-issuance",
      "type": "string"
    },
    "Application": {
      "type": "string",
      "x-go-type": "uuid.UUID",
      "x-go-type-import": {
        "path": "github.com/google/uuid"
      },
      "description": "Application ID to associate with the service account",
      "format": "UUID"
    },
    "ServiceAccountBaseObject": {
      "allOf": [
        {
          "$ref": "#/$defs/ServiceAccountBaseObjectNoKey"
        },
        {
          "type": "object",
          "properties": {
            "publicKey": {
              "description": "The client generated public key",
              "maxLength": 2000,
              "type": "string"
            }
          }
        }
      ]
    },
    "ServiceAccountBaseObjectNoKey": {
      "properties": {
        "owner": {
          "x-go-type": "uuid.UUID",
          "x-go-type-import": {
            "path": "github.com/google/uuid"
          },
          "description": "The UUID of the owning team",
          "format": "UUID",
          "type": "string"
        },
        "scopes": {
          "minItems": 1,
          "type": "array",
          "uniqueItems": true,
          "description": "The list of scopes for which the account is authorized",
          "example": [
            "distributed-issuance"
          ],
          "items": {
            "$ref": "#/$defs/Scope"
          }
        },
        "subject": {
          "description": "The subject of the entity, representing the main topic or title.",
          "example": "Subject",
          "maxLength": 250,
          "minLength": 1,
          "type": "string"
        },
        "applications": {
          "type": "array",
          "uniqueItems": true,
          "description": "The list of applications for which the account is authorized",
          "example": [
            "dc96438b-7a80-464b-a09b-9e5ec746c3e3",
            "5bce5ff4-a69b-4e78-9b7e-6d4029995000"
          ],
          "items": {
            "$ref": "#/$defs/Application"
          }
        },
        "audience": {
          "type": "string",
          "description": "The intended audience or recipients of the entity",
          "example": "Audience",
          "maxLength": 250,
          "minLength": 1
        },
        "authenticationType": {
          "type": "string",
          "description": "Type of authentication used in the scope. Currently supporting two types rsaKey and ociToken",
          "example": "rsaKey"
        },
        "jwksURI": {
          "minLength": 1,
          "type": "string",
          "description": "The URI pointing to the JSON Web Key Set (JWKS) for the entity, facilitating secure authentication",
          "example": "https://www.googleapis.com/oauth2/v3/certs",
          "maxLength": 250
        },
        "companyId": {
          "type": "string",
          "x-go-type": "uuid.UUID",
          "x-go-type-import": {
            "path": "github.com/google/uuid"
          },
          "description": "The UUID of the company/tenant",
          "format": "UUID"
        },
        "credentialLifetime": {
          "description": "The number of days for which the credentials will be valid before expiring and requiring renewal",
          "example": 365,
          "maximum": 365,
          "minimum": 1,
          "type": "integer"
        },
        "issuerURL": {
          "description": "The URL of the entity issuer, providing the source or origin",
          "example": "https://accounts.google.com/",
          "maxLength": 250,
          "minLength": 1,
          "type": "string"
        },
        "name": {
          "description": "User friendly name for the given account",
          "maxLength": 250,
          "minLength": 1,
          "type": "string"
        }
      },
      "type": "object"
    }
  }
}