{
  "$id": "https://example.com/wim-manifest.schema.json",
  "title": "CyberArk Workload Identity Manager Manifests",
  "description": "Schema describing the YAML manifests consumed by vcpctl.",
  "$comments": "Inspired by https://api.venafi.cloud/v3/api-docs/account-service and https://api.venafi.cloud/v3/api-docs/vcamanagement-service",
  "allOf": [
    {
      "type": "object",
      "properties": {
        "kind": {
          "const": "WIMIssuerPolicy"
        },
        "apiVersion": {
          "type": "string"
        }
      },
      "required": [
        "kind",
        "name"
      ]
    },
    {
      "$ref": "#/$defs/PolicyInformation"
    }
  ],
  "$defs": {
    "PropertyInformation": {
      "type": "object",
      "properties": {
        "type": {
          "type": "string",
          "enum": [
            "IGNORED",
            "FORBIDDEN",
            "OPTIONAL",
            "REQUIRED",
            "LOCKED"
          ]
        },
        "allowedValues": {
          "items": {
            "type": "string"
          },
          "type": "array"
        },
        "defaultValues": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "minOccurrences": {
          "type": "integer",
          "format": "int32"
        },
        "maxOccurrences": {
          "type": "integer",
          "format": "int32"
        }
      }
    },
    "SansInformation": {
      "type": "object",
      "properties": {
        "dnsNames": {
          "$ref": "#/$defs/PropertyInformation"
        },
        "ipAddresses": {
          "$ref": "#/$defs/PropertyInformation"
        },
        "rfc822Names": {
          "$ref": "#/$defs/PropertyInformation"
        },
        "uniformResourceIdentifiers": {
          "$ref": "#/$defs/PropertyInformation"
        }
      },
      "description": "Subject alternative names"
    },
    "KeyAlgorithmInformation": {
      "type": "object",
      "properties": {
        "allowedValues": {
          "type": "array",
          "description": "Key algorithm allowed values",
          "items": {
            "type": "string",
            "enum": [
              "RSA_2048",
              "RSA_3072",
              "RSA_4096",
              "EC_P256",
              "EC_P384",
              "EC_P521",
              "EC_ED25519"
            ]
          },
          "minItems": 1
        },
        "defaultValue": {
          "enum": [
            "RSA_2048",
            "RSA_3072",
            "RSA_4096",
            "EC_P256",
            "EC_P384",
            "EC_P521",
            "EC_ED25519"
          ],
          "type": "string",
          "description": "Key algorithm default value",
          "example": "RSA_4096"
        }
      },
      "description": "Key algorithm",
      "required": [
        "allowedValues",
        "defaultValue"
      ]
    },
    "PolicyInformation": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string",
          "description": "UUID of the policy",
          "format": "uuid",
          "example": "8ae92800-b1e0-11ed-859d-b39255f965ee"
        },
        "companyId": {
          "description": "UUID specific to your company",
          "format": "uuid",
          "example": "03eb6e61-9806-11ed-84f2-c747fb71e467",
          "type": "string"
        },
        "name": {
          "type": "string",
          "description": "Name of the policy",
          "example": "Some policy"
        },
        "subject": {
          "$ref": "#/$defs/SubjectAttributesInformation"
        },
        "sans": {
          "$ref": "#/$defs/SansInformation"
        },
        "extendedKeyUsages": {
          "example": [
            "CLIENT_AUTH",
            "SERVER_AUTH"
          ],
          "items": {
            "type": "string",
            "enum": [
              "ANY",
              "SERVER_AUTH",
              "CLIENT_AUTH",
              "CODE_SIGNING",
              "EMAIL_PROTECTION",
              "IPSEC_ENDSYSTEM",
              "IPSEC_TUNNEL",
              "IPSEC_USER",
              "TIME_STAMPING",
              "OCSP_SIGNING",
              "DVCS",
              "SBGP_CERT_AA_SERVER_AUTH",
              "SCVP_RESPONDER",
              "EAP_OVER_PPP",
              "EAP_OVER_LAN",
              "SCVP_SERVER",
              "SCVP_CLIENT",
              "IPSEC_IKE",
              "CAPWAP_AC",
              "CAPWAP_WTP",
              "IPSEC_IKE_INTERMEDIATE",
              "SMARTCARD_LOGON"
            ]
          },
          "type": "array",
          "description": "Extended key usages"
        },
        "keyAlgorithm": {
          "$ref": "#/$defs/KeyAlgorithmInformation"
        },
        "creationDate": {
          "example": "2022-10-10T14:50:41.710+00:00",
          "type": "string",
          "description": "When the policy was initially created"
        },
        "validityPeriod": {
          "type": "string",
          "description": "ISO8601 Period Format",
          "format": "PnYnMnDTnHnMnS",
          "example": "P30D"
        },
        "keyUsages": {
          "type": "array",
          "description": "Key usages",
          "example": [
            "keyEncipherment",
            "digitalSignature"
          ],
          "items": {
            "type": "string",
            "enum": [
              "digitalSignature",
              "nonRepudiation",
              "keyEncipherment",
              "dataEncipherment",
              "keyAgreement",
              "keyCertSign",
              "cRLSign",
              "encipherOnly",
              "decipherOnly"
            ]
          }
        },
        "modificationDate": {
          "type": "string",
          "description": "When the policy was last modified",
          "example": "2023-12-12T20:00:10.500+00:00"
        }
      }
    },
    "SubjectAttributesInformation": {
      "properties": {
        "country": {
          "$ref": "#/$defs/PropertyInformation"
        },
        "commonName": {
          "$ref": "#/$defs/PropertyInformation"
        },
        "organization": {
          "$ref": "#/$defs/PropertyInformation"
        },
        "organizationalUnit": {
          "$ref": "#/$defs/PropertyInformation"
        },
        "locality": {
          "$ref": "#/$defs/PropertyInformation"
        },
        "stateOrProvince": {
          "$ref": "#/$defs/PropertyInformation"
        }
      },
      "description": "Subject attributes",
      "type": "object"
    }
  },
  "$schema": "https://json-schema.org/draft/2020-12/schema"
}