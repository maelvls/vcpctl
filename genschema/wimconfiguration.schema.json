{
  "$comments": "Inspired by https://api.venafi.cloud/v3/api-docs/account-service and https://api.venafi.cloud/v3/api-docs/vcamanagement-service",
  "allOf": [
    {
      "type": "object",
      "properties": {
        "kind": {
          "const": "WIMConfiguration"
        },
        "name": {
          "type": "string",
          "description": "Name of the configuration"
        },
        "subCaProvider": {
          "description": "Name of the Sub CA provider to associate with the configuration",
          "type": "string"
        }
      },
      "required": [
        "kind",
        "name",
        "subCaProvider"
      ]
    },
    {
      "$ref": "#/$defs/ExtendedConfigurationInformation"
    }
  ],
  "$defs": {
    "PropertyInformation": {
      "type": "object",
      "properties": {
        "allowedValues": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "defaultValues": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "minOccurrences": {
          "type": "integer",
          "format": "int32"
        },
        "maxOccurrences": {
          "type": "integer",
          "format": "int32"
        },
        "type": {
          "type": "string",
          "enum": [
            "IGNORED",
            "FORBIDDEN",
            "OPTIONAL",
            "REQUIRED",
            "LOCKED"
          ]
        }
      }
    },
    "ClientAuthenticationInformation": {
      "required": [
        "type"
      ],
      "type": "object",
      "properties": {
        "type": {
          "type": "string"
        }
      },
      "discriminator": {
        "propertyName": "type"
      },
      "oneOf": [
        {
          "$ref": "#/$defs/JwtStandardClaimsAuthenticationInformation"
        },
        {
          "$ref": "#/$defs/JwtJwksAuthenticationInformation"
        },
        {
          "$ref": "#/$defs/JwtOidcAuthenticationInformation"
        }
      ]
    },
    "AzureCloudProviderInformation": {
      "required": [
        "subscriptionIds"
      ],
      "type": "object",
      "properties": {
        "subscriptionIds": {
          "minItems": 1,
          "type": "array",
          "description": "Array of Azure subscription IDs each of which should be UUID",
          "example": [
            "8d10da13-8125-4ba9-a717-bf7490507b3d"
          ],
          "items": {
            "type": "string",
            "format": "uuid"
          }
        }
      }
    },
    "SansInformation": {
      "type": "object",
      "properties": {
        "dnsNames": {
          "$ref": "#/$defs/PropertyInformation"
        },
        "ipAddresses": {
          "$ref": "#/$defs/PropertyInformation"
        },
        "rfc822Names": {
          "$ref": "#/$defs/PropertyInformation"
        },
        "uniformResourceIdentifiers": {
          "$ref": "#/$defs/PropertyInformation"
        }
      },
      "description": "Subject alternative names"
    },
    "ClientAuthorizationInformation": {
      "type": "object",
      "properties": {
        "customClaimsAliases": {
          "$ref": "#/$defs/CustomClaimsAliasesInformation"
        }
      }
    },
    "PolicyInformation": {
      "type": "object",
      "properties": {
        "name": {
          "type": "string",
          "description": "Name of the policy",
          "example": "Some policy"
        },
        "validityPeriod": {
          "description": "ISO8601 Period Format",
          "format": "PnYnMnDTnHnMnS",
          "example": "P30D",
          "type": "string"
        },
        "keyUsages": {
          "type": "array",
          "description": "Key usages",
          "example": [
            "keyEncipherment",
            "digitalSignature"
          ],
          "items": {
            "type": "string",
            "enum": [
              "digitalSignature",
              "nonRepudiation",
              "keyEncipherment",
              "dataEncipherment",
              "keyAgreement",
              "keyCertSign",
              "cRLSign",
              "encipherOnly",
              "decipherOnly"
            ]
          }
        },
        "extendedKeyUsages": {
          "type": "array",
          "description": "Extended key usages",
          "example": [
            "CLIENT_AUTH",
            "SERVER_AUTH"
          ],
          "items": {
            "type": "string",
            "enum": [
              "ANY",
              "SERVER_AUTH",
              "CLIENT_AUTH",
              "CODE_SIGNING",
              "EMAIL_PROTECTION",
              "IPSEC_ENDSYSTEM",
              "IPSEC_TUNNEL",
              "IPSEC_USER",
              "TIME_STAMPING",
              "OCSP_SIGNING",
              "DVCS",
              "SBGP_CERT_AA_SERVER_AUTH",
              "SCVP_RESPONDER",
              "EAP_OVER_PPP",
              "EAP_OVER_LAN",
              "SCVP_SERVER",
              "SCVP_CLIENT",
              "IPSEC_IKE",
              "CAPWAP_AC",
              "CAPWAP_WTP",
              "IPSEC_IKE_INTERMEDIATE",
              "SMARTCARD_LOGON"
            ]
          }
        },
        "keyAlgorithm": {
          "$ref": "#/$defs/KeyAlgorithmInformation"
        },
        "modificationDate": {
          "example": "2023-12-12T20:00:10.500+00:00",
          "type": "string",
          "description": "When the policy was last modified"
        },
        "id": {
          "type": "string",
          "description": "UUID of the policy",
          "format": "uuid",
          "example": "8ae92800-b1e0-11ed-859d-b39255f965ee"
        },
        "companyId": {
          "type": "string",
          "description": "UUID specific to your company",
          "format": "uuid",
          "example": "03eb6e61-9806-11ed-84f2-c747fb71e467"
        },
        "subject": {
          "$ref": "#/$defs/SubjectAttributesInformation"
        },
        "sans": {
          "$ref": "#/$defs/SansInformation"
        },
        "creationDate": {
          "example": "2022-10-10T14:50:41.710+00:00",
          "type": "string",
          "description": "When the policy was initially created"
        }
      }
    },
    "SubCaProviderInformation": {
      "type": "object",
      "properties": {
        "validityPeriod": {
          "type": "string",
          "description": "ISO8601 Period Format",
          "format": "PnYnMnDTnHnMnS",
          "example": "P30D"
        },
        "locality": {
          "example": "San Antonio",
          "type": "string",
          "description": "Locality"
        },
        "name": {
          "type": "string",
          "description": "Name of the Sub CA provider",
          "example": "Some Sub CA provider"
        },
        "stateOrProvince": {
          "example": "Texas",
          "type": "string",
          "description": "State or province"
        },
        "country": {
          "type": "string",
          "description": "Country",
          "example": "US"
        },
        "pkcs11": {
          "$ref": "#/$defs/SubCaProviderPkcs11ConfigurationInformation"
        },
        "creationDate": {
          "type": "string",
          "description": "When the Sub CA provider was initially created",
          "example": "2022-10-10T14:50:41.710+00:00"
        },
        "modificationDate": {
          "example": "2023-12-12T20:00:10.500+00:00",
          "type": "string",
          "description": "When the Sub CA provider was last modified"
        },
        "caAccountId": {
          "type": "string",
          "description": "UUID of the CA account used by this Sub CA provider",
          "format": "uuid",
          "example": "4ece3180-b1e0-11ed-862d-ad36b18e787a"
        },
        "commonName": {
          "type": "string",
          "description": "Common name",
          "example": "example.com"
        },
        "id": {
          "type": "string",
          "description": "UUID of the Sub CA provider",
          "format": "uuid",
          "example": "2f3c6030-b1e0-11ed-a3ed-e3dbaf56a746"
        },
        "caType": {
          "enum": [
            "MOCKCA",
            "DIGICERT",
            "GLOBALSIGN",
            "BUILTIN",
            "ENTRUST",
            "MICROSOFT",
            "ACME",
            "ZTPKI",
            "GLOBALSIGNMSSL",
            "TPP"
          ],
          "type": "string",
          "description": "Type of CA this Sub CA provider works with",
          "example": "BUILTIN"
        },
        "organization": {
          "type": "string",
          "description": "Organization",
          "example": "Some organization"
        },
        "organizationalUnit": {
          "example": "Some organizational unit",
          "type": "string",
          "description": "Organizational unit"
        },
        "keyAlgorithm": {
          "enum": [
            "RSA_2048",
            "RSA_3072",
            "RSA_4096",
            "EC_P256",
            "EC_P384",
            "EC_P521",
            "EC_ED25519"
          ],
          "type": "string",
          "description": "Key algorithm type",
          "example": "EC_P256"
        },
        "companyId": {
          "type": "string",
          "description": "UUID specific to your company",
          "format": "uuid",
          "example": "03eb6e61-9806-11ed-84f2-c747fb71e467"
        },
        "caProductOptionId": {
          "type": "string",
          "description": "UUID of the CA product option used by this Sub CA provider",
          "format": "uuid",
          "example": "6b3d8d20-b1e0-11ed-9c2f-953e35982bbd"
        }
      }
    },
    "KeyAlgorithmInformation": {
      "required": [
        "allowedValues",
        "defaultValue"
      ],
      "type": "object",
      "properties": {
        "allowedValues": {
          "minItems": 1,
          "type": "array",
          "description": "Key algorithm allowed values",
          "items": {
            "type": "string",
            "enum": [
              "RSA_2048",
              "RSA_3072",
              "RSA_4096",
              "EC_P256",
              "EC_P384",
              "EC_P521",
              "EC_ED25519"
            ]
          }
        },
        "defaultValue": {
          "type": "string",
          "description": "Key algorithm default value",
          "example": "RSA_4096",
          "enum": [
            "RSA_2048",
            "RSA_3072",
            "RSA_4096",
            "EC_P256",
            "EC_P384",
            "EC_P521",
            "EC_ED25519"
          ]
        }
      },
      "description": "Key algorithm"
    },
    "ExtendedConfigurationInformation": {
      "type": "object",
      "properties": {
        "clientAuthorization": {
          "$ref": "#/$defs/ClientAuthorizationInformation"
        },
        "cloudProviders": {
          "$ref": "#/$defs/CloudProvidersInformation"
        },
        "shortLivedCertCount": {
          "description": "Number of short lived certificates",
          "format": "int64",
          "example": 20,
          "type": "integer"
        },
        "ultraShortLivedCertCount": {
          "description": "Number of ultra short lived certificates",
          "format": "int64",
          "example": 200,
          "type": "integer"
        },
        "modificationDate": {
          "type": "string",
          "description": "When the configuration was last modified",
          "example": "2023-12-12T20:00:10.500+00:00"
        },
        "subCaProvider": {
          "$ref": "#/$defs/SubCaProviderInformation"
        },
        "policies": {
          "items": {
            "$ref": "#/$defs/PolicyInformation"
          },
          "type": "array"
        },
        "companyId": {
          "type": "string",
          "description": "UUID specific to your company",
          "format": "uuid",
          "example": "03eb6e61-9806-11ed-84f2-c747fb71e467"
        },
        "policyIds": {
          "type": "array",
          "description": "Array of UUIDs of policies to associate with the configuration",
          "format": "uuid",
          "example": [
            "8ae92800-b1e0-11ed-859d-b39255f965ee"
          ],
          "items": {
            "type": "string",
            "format": "uuid"
          }
        },
        "controllerAllowedPolicyIds": {
          "type": "array",
          "description": "Array of UUIDs of policies that the kubernetes controller is permitted to use",
          "format": "uuid",
          "example": [
            "8ae92800-b1e0-11ed-859d-b39255f965ee"
          ],
          "items": {
            "format": "uuid",
            "type": "string"
          }
        },
        "clientAuthentication": {
          "$ref": "#/$defs/ClientAuthenticationInformation"
        },
        "minTlsVersion": {
          "type": "string",
          "description": "Minimum required TLS protocol version",
          "enum": [
            "TLS12",
            "TLS13"
          ]
        },
        "id": {
          "type": "string",
          "description": "UUID of the configuration",
          "format": "uuid",
          "example": "7268d820-a08d-11ed-bbc0-252385d6d389"
        },
        "unixSocketAllowedPolicyIds": {
          "items": {
            "type": "string",
            "format": "uuid"
          },
          "type": "array",
          "description": "Array of UUIDs of policies that are permitted to be used when using the unix socket",
          "format": "uuid",
          "example": [
            "8ae92800-b1e0-11ed-859d-b39255f965ee"
          ]
        },
        "serviceAccountIds": {
          "items": {
            "format": "uuid",
            "type": "string"
          },
          "type": "array"
        },
        "advancedSettings": {
          "$ref": "#/$defs/AdvancedSettingsInformation"
        },
        "longLivedCertCount": {
          "format": "int64",
          "example": 2,
          "type": "integer",
          "description": "Number of long lived certificates"
        },
        "creationDate": {
          "description": "When the configuration was initially created",
          "example": "2022-10-10T14:50:41.710+00:00",
          "type": "string"
        },
        "policyDefinitions": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/PolicyInformation"
          }
        },
        "name": {
          "type": "string",
          "description": "Name of the configuration",
          "example": "Some configuration"
        }
      }
    },
    "SubjectAttributesInformation": {
      "type": "object",
      "properties": {
        "organization": {
          "$ref": "#/$defs/PropertyInformation"
        },
        "organizationalUnit": {
          "$ref": "#/$defs/PropertyInformation"
        },
        "locality": {
          "$ref": "#/$defs/PropertyInformation"
        },
        "stateOrProvince": {
          "$ref": "#/$defs/PropertyInformation"
        },
        "country": {
          "$ref": "#/$defs/PropertyInformation"
        },
        "commonName": {
          "$ref": "#/$defs/PropertyInformation"
        }
      },
      "description": "Subject attributes"
    },
    "JwtClientInformation": {
      "required": [
        "issuer",
        "name",
        "subjects"
      ],
      "type": "object",
      "properties": {
        "name": {
          "minLength": 0,
          "type": "string",
          "description": "Name of the client",
          "example": "Some client",
          "maxLength": 64
        },
        "issuer": {
          "maxLength": 2048,
          "minLength": 0,
          "type": "string",
          "description": "Issuer of the JWT",
          "example": "https://kubernetes.default.svc"
        },
        "jwksUri": {
          "type": "string",
          "description": "URL used to pull the trusted singing keys used for validation",
          "example": "https://www.example.com:6443/jwks",
          "maxLength": 2048,
          "minLength": 0
        },
        "subjects": {
          "minItems": 1,
          "type": "array",
          "description": "Array of subjects of the JWT",
          "example": [
            "system:serviceaccount:venafi:application-team-1"
          ],
          "items": {
            "type": "string"
          }
        },
        "allowedPolicyIds": {
          "type": "array",
          "description": "Array of UUIDs of policies that the client is permitted to use",
          "format": "uuid",
          "example": [
            "8ae92800-b1e0-11ed-859d-b39255f965ee"
          ],
          "items": {
            "type": "string",
            "format": "uuid"
          },
          "minItems": 1
        }
      }
    },
    "JwtJwksAuthenticationInformation": {
      "required": [
        "urls"
      ],
      "type": "object",
      "allOf": [
        {
          "properties": {
            "urls": {
              "minItems": 1,
              "type": "array",
              "description": "Array of JWT JWKS urls",
              "example": [
                "https://jwks.example.com"
              ],
              "items": {
                "type": "string"
              }
            }
          },
          "type": "object"
        }
      ]
    },
    "CustomClaimsAliasesInformation": {
      "type": "object",
      "properties": {
        "configuration": {
          "maxLength": 128,
          "minLength": 0,
          "type": "string"
        },
        "allowAllPolicies": {
          "maxLength": 128,
          "minLength": 0,
          "type": "string"
        },
        "allowedPolicies": {
          "minLength": 0,
          "type": "string",
          "maxLength": 128
        }
      }
    },
    "JwtStandardClaimsAuthenticationInformation": {
      "required": [
        "audience",
        "clients"
      ],
      "type": "object",
      "allOf": [
        {
          "type": "object",
          "properties": {
            "clients": {
              "minItems": 1,
              "type": "array",
              "description": "List with clients, identified by processing JWTs that include standard/registered claims",
              "items": {
                "$ref": "#/$defs/JwtClientInformation"
              }
            },
            "audience": {
              "example": "Client1",
              "maxLength": 256,
              "minLength": 0,
              "type": "string",
              "description": "Recipients that the JWT is intended for"
            }
          }
        }
      ]
    },
    "CloudProvidersInformation": {
      "type": "object",
      "properties": {
        "google": {
          "$ref": "#/$defs/GoogleCloudProviderInformation"
        },
        "aws": {
          "$ref": "#/$defs/AwsCloudProviderInformation"
        },
        "azure": {
          "$ref": "#/$defs/AzureCloudProviderInformation"
        }
      }
    },
    "JwtOidcAuthenticationInformation": {
      "type": "object",
      "allOf": [
        {
          "properties": {
            "baseUrl": {
              "example": "https://openid.example.com",
              "maxLength": 2048,
              "minLength": 0,
              "type": "string",
              "description": "JWT OpenId base URL"
            },
            "audience": {
              "type": "string",
              "description": "OpenId audience",
              "example": "Client1",
              "maxLength": 256,
              "minLength": 0
            }
          },
          "type": "object"
        }
      ],
      "required": [
        "audience",
        "baseUrl"
      ]
    },
    "AwsCloudProviderInformation": {
      "required": [
        "accountIds",
        "regions"
      ],
      "type": "object",
      "properties": {
        "regions": {
          "type": "array",
          "description": "Array of AWS regions",
          "example": [
            "us-west-1"
          ],
          "items": {
            "type": "string",
            "enum": [
              "us-east-1",
              "us-east-2",
              "us-west-1",
              "us-west-2",
              "af-south-1",
              "ap-east-1",
              "ap-south-2",
              "ap-southeast-3",
              "ap-southeast-4",
              "ap-south-1",
              "ap-northeast-3",
              "ap-northeast-2",
              "ap-southeast-1",
              "ap-southeast-2",
              "ap-northeast-1",
              "ca-central-1",
              "eu-central-1",
              "eu-west-1",
              "eu-west-2",
              "eu-south-1",
              "eu-west-3",
              "eu-south-2",
              "eu-north-1",
              "eu-central-2",
              "me-south-1",
              "me-central-1",
              "sa-east-1",
              "us-gov-east-1",
              "us-gov-west-1"
            ]
          }
        },
        "accountIds": {
          "description": "Array of AWS account IDs each of which should be a 12-digit identifier",
          "example": [
            "123456789012"
          ],
          "items": {
            "type": "string"
          },
          "minItems": 1,
          "type": "array"
        }
      }
    },
    "SubCaProviderPkcs11ConfigurationInformation": {
      "properties": {
        "partitionLabel": {
          "example": "workload-identity-manager-hsm-partition",
          "type": "string",
          "description": "HSM Partition Label"
        },
        "partitionSerialNumber": {
          "pattern": "^[A-Fa-fx0-9]{0,18}$",
          "type": "string",
          "description": "HSM Partition Serial Number",
          "example": "1444210958933"
        },
        "pin": {
          "example": "1234",
          "type": "string",
          "description": "HSM PIN",
          "writeOnly": true
        },
        "allowedClientLibraries": {
          "description": "A collection of strings each of which represents SHA256 hash of an allowed HSM client library",
          "example": [
            "c34d199f2e30bb679cd9b8533b99975465aefe8b023be1b37972f1ab43ab7b2d"
          ],
          "items": {
            "type": "string"
          },
          "type": "array"
        },
        "signingEnabled": {
          "type": "boolean",
          "description": "Indicates whether HSM signing is enabled or not",
          "example": true
        }
      },
      "type": "object"
    },
    "GoogleCloudProviderInformation": {
      "required": [
        "projectIdentifiers",
        "regions"
      ],
      "type": "object",
      "properties": {
        "projectIdentifiers": {
          "example": [
            "415104041262",
            "tokyo-rain-123"
          ],
          "items": {
            "type": "string"
          },
          "minItems": 1,
          "type": "array",
          "description": "Array of Google project identifiers each of which should be a string with int64 number or 6 to 30 lowercase letters, digits, or hyphens, should start with a letter and not contain trailing hyphens"
        },
        "regions": {
          "description": "Array of Google regions",
          "example": [
            "us-west1"
          ],
          "items": {
            "type": "string",
            "enum": [
              "asia-east1",
              "asia-east2",
              "asia-northeast1",
              "asia-northeast2",
              "asia-northeast3",
              "asia-south1",
              "asia-south2",
              "asia-southeast1",
              "asia-southeast2",
              "australia-southeast1",
              "australia-southeast2",
              "europe-central2",
              "europe-north1",
              "europe-southwest1",
              "europe-west1",
              "europe-west12",
              "europe-west2",
              "europe-west3",
              "europe-west4",
              "europe-west6",
              "europe-west8",
              "europe-west9",
              "me-central1",
              "me-west1",
              "northamerica-northeast1",
              "northamerica-northeast2",
              "southamerica-east1",
              "southamerica-west1",
              "us-central1",
              "us-east1",
              "us-east4",
              "us-east5",
              "us-south1",
              "us-west1",
              "us-west2",
              "us-west3",
              "us-west4"
            ]
          },
          "type": "array"
        }
      }
    },
    "AdvancedSettingsInformation": {
      "type": "object",
      "properties": {
        "enableIssuanceAuditLog": {
          "type": "boolean",
          "description": "Whether audit log entries must be generated for each issued certificate",
          "example": false
        },
        "includeRawCertDataInAuditLog": {
          "type": "boolean",
          "description": "Whether the raw certificate data must be included in the audit log entry",
          "example": false
        },
        "requireFIPSCompliantBuild": {
          "type": "boolean",
          "description": "Whether FIPS-compliant build is required",
          "example": false
        }
      }
    }
  },
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://example.com/wim-manifest.schema.json",
  "title": "CyberArk Workload Identity Manager Manifests",
  "description": "Schema describing the YAML manifests consumed by vcpctl."
}